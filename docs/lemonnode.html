<!DOCTYPE html>  <html> <head>   <title>lemonnode.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="authorization.html">                 authorization.coffee               </a>                                           <a class="source" href="essaihttp.html">                 essaihttp.coffee               </a>                                           <a class="source" href="habilit.html">                 habilit.coffee               </a>                                           <a class="source" href="headers.html">                 headers.coffee               </a>                                           <a class="source" href="lemonnode.html">                 lemonnode.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               lemonnode.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">http = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
<span class="nv">Validator= </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./authorization&#39;</span><span class="p">)</span>
<span class="nv">config = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./config.js&#39;</span><span class="p">)</span>
<span class="nv">head   = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./headers.js&#39;</span><span class="p">)</span>
<span class="nv">api_request = </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;api_request&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>alias</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">puts = </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>fonctions internes</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">habilit = </span><span class="nf">(reply,res,auto,origine,loginPortal,codeappli,cookie) -&gt;</span>  
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;dans habilit&quot;</span><span class="p">)</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reply</span><span class="p">)</span>
   <span class="nx">auto</span><span class="p">.</span><span class="nx">compute</span><span class="p">(</span><span class="nx">reply</span><span class="p">,</span><span class="nx">origine</span><span class="p">,</span><span class="nx">loginPortal</span><span class="p">,</span><span class="nx">codeappli</span><span class="p">,</span><span class="nx">cookie</span><span class="p">)</span>      
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;en sortant d&#39;habilit&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>version du lemon:nodeJS</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">version = </span><span class="s2">&quot;0.0&quot;</span>      
<span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">getVersion</span><span class="p">()</span> 
  <span class="nx">puts</span> <span class="s2">&quot;v#{version}&quot;</span> 
  <span class="k">return</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>load config: chargement de la configuration   </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">puts</span> <span class="s2">&quot;Lancement de lemon:nodeJS&quot;</span>
<span class="nx">puts</span> <span class="s2">&quot;Debut chargement de la configuration&quot;</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span>
<span class="nv">my_conf= </span><span class="nx">config</span><span class="p">.</span><span class="nx">getConfigSync</span><span class="p">()</span>
<span class="nx">puts</span> <span class="s2">&quot;acquisition de &quot;</span> <span class="o">+</span> <span class="nx">my_conf</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;port&#39;</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span> 
<span class="nx">puts</span> <span class="s2">&quot;Fin chargement de la configuration&quot;</span>  <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span>
<span class="nx">puts</span> <span class="s2">&quot;Mise en service&quot;</span>  <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span>
<span class="nv">my_cookie = </span> <span class="nx">my_conf</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;cookie&#39;</span><span class="p">]</span> 
<span class="nv">loginPortal = </span><span class="nx">my_conf</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;portal&#39;</span><span class="p">]</span>
<span class="nv">my_globalPort = </span> <span class="nx">my_conf</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;port&#39;</span><span class="p">]</span>  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>main loop </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span>  <span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">puts</span>  <span class="s2">&quot;request incoming:#{request.url}&quot;</span>
    <span class="nx">puts</span>  <span class="s2">&quot;headers incoming:&quot;</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span>
    <span class="nx">puts</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span>
    <span class="nx">puts</span> <span class="nx">request</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span> 
    <span class="nv">state = </span><span class="p">[]</span>
    <span class="nv">origine = </span><span class="s2">&quot;http://&quot;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span>  <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span> 
    <span class="nv">origine2 = </span><span class="nx">origine</span> <span class="o">+</span> <span class="s2">&quot;_cookie=&quot;</span> <span class="o">+</span> <span class="nx">my_cookie</span>
    <span class="nx">state</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">puts</span> <span class="nx">request</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">method</span> <span class="o">+</span>
    <span class="s2">&quot; (HTTP method) &quot;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s2">&quot; (url on) &quot;</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span>  <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>recuperation host et port du  header host</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">HP = </span><span class="nx">head</span><span class="p">.</span><span class="nx">getHostPort</span><span class="p">(</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span> <span class="p">)</span>
    <span class="nv">saveHost = </span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span>  
    <span class="nx">request</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span>  <span class="o">-&gt;</span> <span class="nx">state</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>  
    <span class="nx">puts</span> <span class="s2">&quot;Cible VIP: #{HP[&#39;host&#39;]} sur port #{HP[&#39;port&#39;]}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h1>alignement des headers</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">config_location = </span><span class="nx">my_conf</span><span class="p">[</span><span class="nx">HP</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]]</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>puts "dispatcher: codeappli => #{codeappli}"</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">try</span> 
    	<span class="nv">targetPort= </span><span class="nx">config_location</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span>
    <span class="k">catch</span> <span class="nx">error</span> 
        <span class="nx">puts</span> <span class="s2">&quot;Erreur la location n&#39;existe pas ou est absente de l entete: #{HP[&#39;host&#39;]}&quot;</span>
        <span class="k">return</span> <span class="kc">null</span>
    <span class="nv">codeappli = </span> <span class="nx">config_location</span><span class="p">[</span><span class="s1">&#39;authorization&#39;</span><span class="p">]</span>   
    <span class="nv">myvalidator= </span><span class="k">new</span> <span class="nx">Validator</span>   
    <span class="nv">targetHost= </span><span class="nx">config_location</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">]</span>
    <span class="nv">target = </span><span class="nx">targetHost</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nx">targetPort</span>
    <span class="nx">puts</span> <span class="s2">&quot;Cible RIP :#{targetHost} sur port #{targetPort}&quot;</span> 
    <span class="k">if</span> <span class="nx">config_location</span><span class="p">[</span><span class="s1">&#39;alias&#39;</span><span class="p">]</span> 
       <span class="nv">target = </span><span class="nx">config_location</span><span class="p">[</span><span class="s1">&#39;alias&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">targetPort</span>
    <span class="nv">my_headers = </span><span class="nx">head</span><span class="p">.</span><span class="nx">cloneHeaders</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span><span class="nx">target</span><span class="p">)</span>   
    <span class="nx">puts</span>  <span class="s2">&quot;headers outcoming:&quot;</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span>
    <span class="nx">puts</span> <span class="nx">my_headers</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span> </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h1>check session</h1>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">my_session = </span><span class="nx">head</span><span class="p">.</span><span class="nx">getCookie</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span><span class="nx">my_cookie</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">my_session</span> 
           <span class="nx">puts</span> <span class="s2">&quot;session Ok: #{my_session}&quot;</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">isDebugOn</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>declaration des listeners</p>             </td>             <td class="code">               <div class="highlight"><pre>           <span class="nx">myvalidator</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s1">&#39;expired&#39;</span><span class="p">,</span><span class="nf">(redirection)-&gt;</span>
                   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">(</span><span class="s2">&quot;reprise de la boucle sur expiration&quot;</span><span class="p">)</span>    
                   <span class="nv">headerRedirection = </span><span class="s1">&#39;location&#39;</span> <span class="o">:</span> <span class="nx">redirection</span> 
                   <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">302</span><span class="p">,</span><span class="nx">headerRedirection</span><span class="p">)</span>
                   <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
                   <span class="k">return</span> <span class="kc">null</span> <span class="p">)</span>
           <span class="nx">myvalidator</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s1">&#39;no-auth&#39;</span><span class="p">,</span><span class="nf">(accessdeny)-&gt;</span>
                   <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
                   <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
                   <span class="k">return</span> <span class="kc">null</span> <span class="p">)</span>
           <span class="nx">myvalidator</span><span class="p">.</span><span class="kc">on</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span><span class="nf">(entete)-&gt;</span>
                   <span class="nv">add_header = </span><span class="nx">head</span><span class="p">.</span><span class="nx">addHeaders</span><span class="p">(</span><span class="nx">my_headers</span><span class="p">,</span><span class="nx">entete</span><span class="p">)</span>
                   <span class="nv">my_headers = </span><span class="nx">add_header</span>   
                   <span class="nv">proxy = </span><span class="nx">http</span><span class="p">.</span><span class="nx">createClient</span><span class="p">(</span><span class="nx">targetPort</span><span class="p">,</span><span class="nx">targetHost</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>ajout entete user </p>             </td>             <td class="code">               <div class="highlight"><pre>                   <span class="nv">proxy_request = </span><span class="nx">proxy</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">my_headers</span><span class="p">)</span>
                   <span class="nx">proxy_request</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">,</span>  <span class="p">(</span><span class="nx">proxy_response</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>ajustement de l'entete host dans le sens retour</p>             </td>             <td class="code">               <div class="highlight"><pre>                         <span class="nv">headers_retour = </span><span class="nx">head</span><span class="p">.</span><span class="nx">cloneHeaders</span><span class="p">(</span><span class="nx">proxy_response</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span><span class="nx">saveHost</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>ajustement de l entete location en cas de redirection</p>             </td>             <td class="code">               <div class="highlight"><pre>                         <span class="k">if</span> <span class="nx">proxy_response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="k">in</span> <span class="p">[</span><span class="mi">300</span><span class="p">..</span><span class="mi">309</span><span class="p">]</span> 
                                <span class="nv">hd = </span><span class="nx">headers_retour</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>   
                                <span class="nx">headers_retour</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">head</span><span class="p">.</span><span class="nx">ajustLocation</span><span class="p">(</span><span class="nx">hd</span><span class="p">,</span><span class="nx">target</span><span class="p">,</span><span class="nx">HP</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">],</span><span class="nx">my_globalPort</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h1>TODO</h1>             </td>             <td class="code">               <div class="highlight"><pre>                         <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="nx">proxy_response</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">,</span><span class="nx">headers_retour</span><span class="p">)</span>  
                         <span class="nx">proxy_response</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>  <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">)</span> <span class="p">)</span>
                         <span class="nx">proxy_response</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span>   <span class="o">=&gt;</span>  <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
                   <span class="k">if</span> <span class="nx">state</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>   
                                <span class="nx">request</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span>  <span class="o">-&gt;</span>  <span class="nx">proxy_request</span><span class="p">.</span><span class="nx">end</span><span class="p">())</span> 
                   <span class="k">else</span> 
                                <span class="nx">proxy_request</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span> 
                   <span class="p">)</span>       
               </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>fin declaration des listeners
retrouver la session à partie du numero de cookie - retrieve session with cookie number</p>             </td>             <td class="code">               <div class="highlight"><pre>           <span class="nv">r = </span><span class="k">new</span> <span class="nx">api_request</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">8888</span><span class="p">)</span>
           <span class="nx">r</span><span class="p">.</span><span class="nx">with_content_type</span><span class="p">(</span><span class="s1">&#39;application/json&#39;</span><span class="p">).</span>
           <span class="nx">with_payload</span><span class="p">(</span> <span class="p">{</span> <span class="s1">&#39;cle&#39;</span> <span class="o">:</span>  <span class="nx">my_session</span><span class="p">}).</span>
             <span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/getValue&#39;</span><span class="p">).</span><span class="kc">on</span><span class="p">(</span><span class="s1">&#39;reply&#39;</span><span class="p">,</span>  <span class="nf">(reply,res) -&gt;</span> <span class="nx">habilit</span><span class="p">(</span><span class="nx">reply</span><span class="p">,</span><span class="nx">res</span><span class="p">,</span><span class="nx">myvalidator</span><span class="p">,</span><span class="nx">origine</span><span class="p">,</span><span class="nx">loginPortal</span><span class="p">,</span><span class="nx">codeappli</span><span class="p">,</span><span class="nx">my_cookie</span><span class="p">)</span> <span class="p">)</span> 
    <span class="k">else</span> 
           <span class="nx">puts</span> <span class="s2">&quot;echec sur la récuperation de la session&quot;</span>
           <span class="nv">origine64= </span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">origine2</span><span class="p">)</span>
           <span class="nv">locationURL= </span><span class="nx">loginPortal</span><span class="o">+</span><span class="s2">&quot;?url=&quot;</span> <span class="o">+</span> <span class="nx">origine64</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">)</span>  
           <span class="nx">puts</span> <span class="s2">&quot;Location de redirection: #{locationURL}&quot;</span>
           <span class="nv">headerRedirection= </span><span class="s1">&#39;location&#39;</span> <span class="o">:</span> <span class="nx">locationURL</span> 
           <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">302</span><span class="p">,</span><span class="nx">headerRedirection</span><span class="p">)</span>
           <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
           <span class="k">return</span> <span class="kc">null</span> 

<span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">my_conf</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;port&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="nx">puts</span> <span class="s2">&quot;le serveur lemon:nodeJS V#{version} ecoute sur le port #{my_conf[&#39;global&#39;][&#39;port&#39;]} &quot;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 